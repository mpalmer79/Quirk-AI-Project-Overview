<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<base href="/Quirk-AI-Project-Overview/">
<title>Kiosk • Credit Application</title>

<link rel="stylesheet" href="assets/kiosk-shared.css">
<script src="assets/kiosk-shared.js"></script>

<style>
  /* Fallback watermark + light UI (if shared CSS is missing) */
  body{
    background:
      linear-gradient(rgba(255,255,255,.58), rgba(255,255,255,.58)),
      url("assets/kiosk.png") center/cover fixed no-repeat !important;
    min-height:100vh;
  }
  /* Centered labels above inputs; input width matches label text width */
  .form { display:grid; gap:16px; }
  .grid-2 { display:grid; grid-template-columns: repeat(2,minmax(240px,1fr)); gap:16px; }
  .grid-3 { display:grid; grid-template-columns: repeat(3,minmax(180px,1fr)); gap:16px; }
  .field { display:flex; flex-direction:column; align-items:center; text-align:center; }
  .label { font-weight:600; color:#334155; margin-bottom:6px; }
  .field input, .field select {
    border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; background:#fff; color:#0f172a;
    width:fit-content; max-width:100%;
  }
  .hint { font-size:.8rem; color:#64748b; text-align:center; }
  .section { margin-top:12px; padding-top:12px; border-top:1px dashed #e2e8f0; }
  .btn-row { display:flex; justify-content:center; margin-top:16px; }
  .btn { background:#059669; color:#fff; border:0; padding:12px 18px; border-radius:999px; font-weight:600; }
  .btn:focus-visible { outline:2px solid #34d399; outline-offset:2px; }
  .back { color:#0f172a; padding:10px 14px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; }
  @supports(-webkit-touch-callout:none){ :root{color-scheme:light} select,input,textarea{-webkit-appearance:none} }
</style>
</head>
<body>
  <div class="kx">
    <div class="kx__header">
      <h2>Credit Application</h2>
    </div>

    <form id="creditForm" class="panel form" novalidate>
      <!-- APPLICANT -->
      <div class="grid-2">
        <div class="field">
          <span class="label">Applicant — First name</span>
          <input id="a_first" autocomplete="given-name">
        </div>
        <div class="field">
          <span class="label">Applicant — Last name</span>
          <input id="a_last" autocomplete="family-name">
        </div>
      </div>

      <div class="grid-3">
        <div class="field">
          <span class="label">Date of birth</span>
          <input id="a_dob" type="date" inputmode="none">
        </div>
        <div class="field">
          <span class="label">SSN</span>
          <input id="a_ssn" inputmode="numeric" maxlength="11" placeholder="123-45-6789">
          <div class="hint">We’ll mask this automatically</div>
        </div>
        <div class="field">
          <span class="label">Email</span>
          <input id="a_email" type="email" autocomplete="email">
        </div>
      </div>

      <div class="grid-3">
        <div class="field">
          <span class="label">Mobile</span>
          <input id="a_mobile" inputmode="tel" autocomplete="tel">
        </div>
        <div class="field">
          <span class="label">ZIP</span>
          <input id="a_zip" inputmode="numeric" maxlength="10" autocomplete="postal-code">
        </div>
        <div class="field">
          <span class="label">Monthly income ($)</span>
          <input id="a_income" type="number" min="0" step="100">
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <span class="label">Employer</span>
          <input id="a_employer" autocomplete="organization">
        </div>
        <div class="field">
          <span class="label">Job title</span>
          <input id="a_title" autocomplete="organization-title">
        </div>
      </div>

      <!-- CO-APPLICANT -->
      <div class="section">
        <div class="hint" style="margin-bottom:8px">Add a co-applicant (optional)</div>
        <div class="grid-2">
          <div class="field">
            <span class="label">Co-Applicant — First name</span>
            <input id="c_first" autocomplete="given-name">
          </div>
          <div class="field">
            <span class="label">Co-Applicant — Last name</span>
            <input id="c_last" autocomplete="family-name">
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <span class="label">Date of birth</span>
            <input id="c_dob" type="date">
          </div>
          <div class="field">
            <span class="label">SSN</span>
            <input id="c_ssn" inputmode="numeric" maxlength="11" placeholder="123-45-6789">
            <div class="hint">We’ll mask this automatically</div>
          </div>
          <div class="field">
            <span class="label">Monthly income ($)</span>
            <input id="c_income" type="number" min="0" step="100">
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn" id="next">Let’s make sure it’s you →</button>
      </div>

      <div class="btn-row">
        <a class="back" href="saleskiosk-welcome.html">← Back to Kiosk</a>
      </div>
    </form>
  </div>

<script>
/* ---------- helpers (fallback if kiosk-shared.js is absent) ---------- */
const kiosk = window.kiosk || {
  save:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}},
  load:(k,d)=>{try{const v=JSON.parse(localStorage.getItem(k)); return (v ?? d)}catch{return d}},
  track:()=>{}, post:()=>{}
};
const { save, load, track, post } = kiosk;

/* ---------- make input width match its label text length ---------- */
function matchInputToLabelWidth(){
  document.querySelectorAll('.field').forEach(f=>{
    const label = f.querySelector('.label');
    const inp = f.querySelector('input,select');
    if(!label || !inp) return;
    const ch = Math.max(12, label.textContent.trim().length + 4); // padding
    inp.style.width = ch + 'ch';
  });
}
matchInputToLabelWidth();
window.addEventListener('resize', matchInputToLabelWidth);

/* ---------- phone formatting ---------- */
const onlyDigits = v=> (v||'').replace(/\D+/g,'');
const fmtPhone = d=>{
  const x = (d||'').slice(0,10);
  if(!x) return '';
  if(x.length<4) return `(${x}`;
  if(x.length<7) return `(${x.slice(0,3)}) ${x.slice(3)}`;
  return `(${x.slice(0,3)}) ${x.slice(3,6)}-${x.slice(6)}`;
};
const aMobile = document.getElementById('a_mobile');
aMobile.addEventListener('input', e=>{
  const caret = e.target.value.length - e.target.selectionStart;
  e.target.value = fmtPhone(onlyDigits(e.target.value));
  const pos = Math.max(0, e.target.value.length - caret);
  requestAnimationFrame(()=> e.target.setSelectionRange(pos,pos));
});

/* ---------- SSN masking: mask immediately on blur; keep editable ---------- */
function attachSSNMask(id){
  const el = document.getElementById(id);
  let raw = '';
  el.addEventListener('input', ()=>{
    // allow typed dashes; normalize to ###-##-####
    raw = onlyDigits(el.value).slice(0,9);
    const p = [raw.slice(0,3), raw.slice(3,5), raw.slice(5)].filter(Boolean);
    el.dataset.raw = raw;
    el.value = p.join(raw.length>5?'-':'-');
  });
  el.addEventListener('blur', ()=>{
    // show as password bullets but keep raw in data attr
    if (el.dataset.raw && el.dataset.raw.length >= 4) {
      el.type = 'password';
    }
  });
  el.addEventListener('focus', ()=>{
    // keep masked while editing
    el.type = 'password';
  });
}
attachSSNMask('a_ssn');
attachSSNMask('c_ssn');

/* ---------- validation rules ----------
   IF First + Last provided for Applicant -> DOB & SSN REQUIRED.
   IF First + Last provided for Co-Applicant -> DOB & SSN REQUIRED.
--------------------------------------------------------------------------- */
function need(a,b){ return (a.value.trim() && b.value.trim()); }
function requiredIfNamesPresent(){
  const aReq = need(a_first, a_last);
  const cReq = need(c_first, c_last);
  a_dob.required = aReq; a_ssn.required = aReq;
  c_dob.required = cReq; c_ssn.required = cReq;
}
['a_first','a_last','c_first','c_last'].forEach(id=>{
  document.getElementById(id).addEventListener('input', requiredIfNamesPresent);
});
requiredIfNamesPresent();

/* ---------- submit / next ---------- */
document.getElementById('next').addEventListener('click', (e)=>{
  e.preventDefault();

  requiredIfNamesPresent();
  const form = document.getElementById('creditForm');
  if (!form.checkValidity()) {
    form.reportValidity();
    return;
  }

  // Persist essentials for later steps
  const payload = {
    applicant:{
      first:a_first.value.trim(), last:a_last.value.trim(),
      dob:a_dob.value, ssn:document.getElementById('a_ssn').dataset.raw || '',
      email:a_email.value.trim(), mobile:a_mobile.value.trim(),
      zip:a_zip.value.trim(), income:Number(a_income.value||0),
      employer:a_employer.value.trim(), title:a_title.value.trim()
    },
    coapplicant:{
      first:c_first.value.trim(), last:c_last.value.trim(),
      dob:c_dob.value, ssn:document.getElementById('c_ssn').dataset.raw || '',
      income:Number(c_income.value||0)
    }
  };
  save('guided_credit_app', payload);

  // proceed to MFA step (same page flow you already had)
  window.location.href = 'kiosk-verify-phone.html'; // if you keep MFA on its own page
  // Or, if you keep MFA inline, replace with: post('credit:done')
});
</script>
</body>
</html>
