<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VIN Gen AI Alternative</title>

  <!-- Force LIGHT theme -->
  <meta name="color-scheme" content="light" />

  <!-- Keep all relative URLs under this GitHub Pages project -->
  <base href="/Quirk-AI-Project-Overview/">

  <!-- Sitewide styles (topbar, fonts, watermark rules, etc.) -->
  <link rel="stylesheet" href="assets/style.css" />

  <style>
    /* ===== Page-scoped polish for VIN Gen AI Alternative ===== */
    .page-wrap { max-width: 1080px; margin: 0 auto; padding: 28px 20px 72px; }
    .hero { text-align: center; margin: 16px 0 24px; }
    .hero h1 { margin: 0 0 8px; font-size: clamp(1.6rem, 3vw, 2.2rem); }
    .hero p { margin: 0; color: #475569; }

    .btn { display:inline-block; border:1px solid #0b6e37; padding:10px 14px; border-radius:999px; text-decoration:none; color:#0b6e37; font-weight:600; text-align:center; background:#fff; }
    .btn:hover { background:#0b6e37; color:#fff; }
    .btn.small { padding:6px 10px; font-weight:600; }

    /* Section scaffolding */
    .section { margin: 28px 0; }
    .section h2 { margin: 0 0 8px; font-size: clamp(1.25rem, 2.6vw, 1.6rem); }
    .muted { color: #475569; }
    .small { font-size: .92rem; }

    .cards { display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .card { border: 1px solid #e2e8f0; border-radius: 16px; background: #fff; padding: 16px; }
    .card h3 { margin: 0 0 6px; font-size: 1.05rem; }
    .card p { margin: 6px 0 0; }

    details { border: 1px dashed #e2e8f0; border-radius: 12px; padding: 12px 14px; background: #fff; }
    details + details { margin-top: 10px; }
    summary { cursor: pointer; font-weight: 600; }
    summary::marker { color: #0b6e37; }

    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { border: 1px solid #e2e8f0; padding: 10px; text-align: left; }
    .table th { background: #f8fafc; font-weight: 600; }

    .callout { border-left: 4px solid #0b6e37; background: #f6fff9; padding: 10px 12px; border-radius: 8px; }

    /* Pill styling + badges */
    .pillbar { display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:8px; }
    .pill { display:inline-block; border:1px solid #0b6e37; color:#0b6e37; background:#ffffff; padding:6px 12px; border-radius:999px; font-weight:700; }
    .pill.sub { border-color:#cbd5e1; color:#334155; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:.78rem; font-weight:700; border:1px solid #cbd5e1; color:#334155; }
    .badge.ok { border-color:#0b6e37; color:#0b6e37; }
    .badge.stale { border-color:#b45309; color:#b45309; }
    .badge.missing { border-color:#64748b; color:#64748b; }

    /* a11y helper in case sitewide CSS doesn't include it */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

    /* Footer */
    .footer { text-align:center; padding:24px 12px; color:#64748b; }
  </style>
</head>
<body class="page">
  <div class="home-wrap">
    <a class="home-btn" href="https://mpalmer79.github.io/Quirk-AI-Project-Overview/">HOME</a>
  </div>

  <!-- ======= Top Navigation Bar ======= -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <a class="home-link" href="./">HOME</a>
      <div class="topbar-title">VIN Gen AI Alternative</div>
      <nav class="topbar-menu" aria-label="Secondary Navigation">
        <a class="topbar-title-link" href="project-library.html">Project Library</a>
      </nav>
    </div>
  </header>

  <!-- ======= Page Content ======= -->
  <main class="page-wrap" id="top">
    <section class="hero">
      <h1>VIN Gen&nbsp;AI Alternative — Appointment-First Automation</h1>
      <p class="muted">Designed for BDC teams to respond faster, book more shows, and keep every touch logged in VIN Solutions.</p>
    </section>

    <!-- >>>>>> Agent Playground <<<<<< -->
    <section id="playground" class="section">
      <div class="pillbar" aria-hidden="true">
        <span class="pill">Agent Playground</span>
        <span class="pill sub">Draft → Approve → Send</span>
        <span id="oemHealthBadge" class="badge missing" title="OEM offers feed health">OEM: Missing</span>
      </div>
      <h2 class="sr-only">Agent Playground (Draft → Approve → Send)</h2>
      <p class="muted">Paste a lead, pick a model/trim, and generate a ready-to-send draft that always drives to two appointment options.</p>

      <details>
        <summary>Open for more (what this does)</summary>
        <div class="small" style="margin-top:8px">
          <ul>
            <li>Builds an email/SMS with [[stock_count]], [[model_trim]], [[cash_rebate]], [[apr_rate]], [[two_appt_options]], and lease tokens when available.</li>
            <li>Today: uses front-end logic + a tiny Worker to normalize GM Financial offers. Later: switch <code>API_BASE</code> to your AutoGPT Platform URL.</li>
          </ul>
        </div>
      </details>

      <div class="cards" style="margin-top:12px">
        <div class="card">
          <h3>Lead Context</h3>
          <label class="small" for="leadText">Paste lead snippet (name, interest, zip, notes)</label>
          <textarea id="leadText" rows="6" style="width:100%;border:1px solid #e2e8f0;border-radius:10px;padding:10px"></textarea>

          <div style="display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin-top:10px">
            <div>
              <label class="small" for="make">Make</label>
              <input id="make" class="small" style="width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:8px" value="Chevrolet" />
            </div>
            <div>
              <label class="small" for="model">Model</label>
              <input id="model" class="small" style="width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:8px" value="Traverse" />
            </div>
            <div>
              <label class="small" for="zip">ZIP (inventory)</label>
              <input id="zip" class="small" style="width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:8px" value="03103" />
            </div>
            <div>
              <label class="small" for="offersZip">ZIP (offers override)</label>
              <input id="offersZip" class="small" style="width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:8px" value="03103" />
            </div>
            <div>
              <label class="small" for="channel">Channel</label>
              <select id="channel" class="small" style="width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:8px">
                <option value="email">Email</option>
                <option value="sms">SMS</option>
              </select>
            </div>
          </div>

          <button id="composeBtn" class="btn" style="margin-top:12px">Generate Draft</button>
        </div>

        <div class="card">
          <h3>Output</h3>
          <div id="draftPane" class="small" style="white-space:pre-wrap;min-height:140px;border:1px dashed #e2e8f0;border-radius:10px;padding:10px"></div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="copyDraftBtn" class="btn small">Copy</button>
            <button id="saveRunBtn" class="btn small" title="Simulates logging a run like AutoGPT Platform">Save as Run</button>
          </div>
          <details style="margin-top:10px">
            <summary>Open for more (cURL for backend wiring)</summary>
<pre class="small" id="curlBlock" style="overflow:auto"></pre>
          </details>
        </div>
      </div>
    </section>
    <!-- >>>>>> END Agent Playground <<<<<< -->

    <!-- Executive Summary -->
    <section id="executive-summary" class="section">
      <h2>Executive Summary</h2>
      <p class="muted">VIN Solutions remains your CRM backbone. The Gen&nbsp;AI layer personalizes emails/SMS/call prompts in real time, injects inventory & incentives, and auto-logs tasks/appointments in VIN.</p>

      <div class="cards">
        <div class="card">
          <h3>Current Pain (VIN-only)</h3>
          <ul class="small">
            <li>Canned templates feel impersonal</li>
            <li>Heavy manual personalization & task follow-up</li>
            <li>Slow response on busy days</li>
            <li>Appointments depend on agent skill</li>
          </ul>
        </div>
        <div class="card">
          <h3>Gen AI Overlay</h3>
          <ul class="small">
            <li>&lt; 5-minute responses with inventory & incentives</li>
            <li>Tasks/appointments created & logged in VIN</li>
            <li>Consistent appointment push with 2 time options</li>
            <li>Projected +15–20% appointment conversion lift</li>
          </ul>
        </div>
      </div>

      <details class="section">
        <summary>Open for more (proof points & examples)</summary>
        <div class="callout small" style="margin-top:10px">
          <strong>Example</strong>: “We have 3 Traverses in stock including RS; $1,500 customer cash + 2.9% APR. Can I reserve one for Thursday evening or Saturday morning?”
        </div>
      </details>
    </section>

    <!-- KPIs -->
    <section id="kpis" class="section">
      <h2>Target KPIs</h2>
      <div class="kpi-grid" style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin:12px 0 24px;">
        <div class="tile" style="border:1px solid #e2e8f0;border-radius:16px;padding:16px 14px;background:#fff;">
          <h3>Appointment Conversion</h3>
          <div class="num" style="font-size:1.6rem;font-weight:800;">+15–20%</div>
          <div class="muted small">within 6 months</div>
        </div>
        <div class="tile" style="border:1px solid #e2e8f0;border-radius:16px;padding:16px 14px;background:#fff;">
          <h3>Response Speed</h3>
          <div class="num" style="font-size:1.6rem;font-weight:800;">&lt; 5 min</div>
          <div class="muted small">avg compose+send</div>
        </div>
        <div class="tile" style="border:1px solid #e2e8f0;border-radius:16px;padding:16px 14px;background:#fff;">
          <h3>Staff Workload</h3>
          <div class="num" style="font-size:1.6rem;font-weight:800;">−30%</div>
          <div class="muted small">manual tasks/emails</div>
        </div>
        <div class="tile" style="border:1px solid #e2e8f0;border-radius:16px;padding:16px 14px;background:#fff;">
          <h3>Follow-up Compliance</h3>
          <div class="num" style="font-size:1.6rem;font-weight:800;">95%+</div>
          <div class="muted small">VIN tasks on time</div>
        </div>
      </div>
    </section>

    <!-- Workflow Comparison -->
    <section id="workflow" class="section">
      <h2>Workflow Comparison</h2>
      <div class="cards">
        <div class="card">
          <h3>VIN Solutions (Today)</h3>
          <ol class="small">
            <li>New lead → manual template pick</li>
            <li>Agent edits pricing/inventory</li>
            <li>Manual task & appt creation</li>
            <li>Follow-ups depend on agent</li>
          </ol>
        </div>
        <div class="card">
          <h3>Gen AI Alternative (Overlay)</h3>
          <ol class="small">
            <li>Lead hits VIN → AI pulls inventory + incentives</li>
            <li>AI composes email/SMS w/ 2 appt slots (&lt;5 min)</li>
            <li>Auto-logs activity & creates VIN task/appointment</li>
            <li>AI re-nudges at 24/48h; manager escalates at 7d</li>
          </ol>
        </div>
      </div>

      <details class="section">
        <summary>Open for more (sample activity log fields)</summary>
        <div class="small" style="margin-top:8px">
          <ul>
            <li><code>activity_note(html)</code> with inventory & incentive tokens</li>
            <li><code>lead_id</code>, <code>suggested_times</code>, <code>task_due_at</code></li>
            <li><code>appointment(start/end)</code> on acceptance</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- Smart Response Library -->
    <section id="library" class="section">
      <h2>Smart Response Library (Sampler)</h2>
      <p class="muted">Standardized email/SMS/call prompts that always push toward an appointment.</p>

      <div class="cards">
        <div class="card">
          <h3>New Internet Lead — Inventory</h3>
          <p class="small"><strong>Email</strong>: “Hi [Name], we currently have <em>[stock_count]</em> [Model] in stock including [trim]. This week: <em>[cash_rebate]</em> + <em>[apr_rate]</em>. Would Thursday 6:15pm or Saturday 10:30am work for a quick drive?”</p>
        </div>
        <div class="card">
          <h3>Best Price Inquiry</h3>
          <p class="small">“The [Model] is $[price] with incentives. I can have one ready for you — does Thursday evening or Saturday morning work best?”</p>
        </div>
        <div class="card">
          <h3>“I’m Just Shopping”</h3>
          <p class="small">“Totally understand. How about a quick 15-minute no-obligation test drive? It’ll help you compare. Thursday or Saturday?”</p>
        </div>
        <div class="card">
          <h3>No Response 24/48h</h3>
          <p class="small">Light nudge with inventory/incentive reminder and two new times. Auto-schedules in VIN.</p>
        </div>
      </div>

      <details class="section">
        <summary>Open for more (all 20 scenarios list)</summary>
        <div class="small" style="margin-top:8px">
          Includes: Trade-In Interest, Lease vs Purchase, Appointment Confirmation, Reschedule, Missed Appt Recovery, Post-Test-Drive, Manager Escalation, Final-Chance Closeout, Post-Sale Thank You, Unsold Visit Follow-Up, End-of-Month Push, Credit-Challenged, Out-of-Area, Vehicle On-Order, Vehicle Sold — Alternatives, Service-to-Sales Equity Mining, and more.
        </div>
      </details>
    </section>

    <!-- Training & Roleplay -->
    <section id="training" class="section">
      <h2>Training & Roleplay</h2>
      <p class="muted">Run calls twice: first with a typical VIN template, then with AI prompts. Measure whether the appointment was secured.</p>

      <div class="cards">
        <div class="card">
          <h3>Traverse Example (Phone)</h3>
          <p class="small"><strong>AI prompt</strong>: mention stock count → cite incentive → offer two times. Consistent appointment push beats generic invites.</p>
        </div>
        <div class="card">
          <h3>Objection Handling</h3>
          <p class="small">Reassure → low-commitment visit → two time options. Keeps the conversation alive and directed to a show.</p>
        </div>
      </div>

      <details class="section">
        <summary>Open for more (quick drill checklist)</summary>
        <ul class="small" style="margin-top:8px">
          <li>Pair up (customer/agent)</li>
          <li>Run VIN style → score outcome</li>
          <li>Run AI style → score outcome</li>
          <li>Note confidence, clarity, and appointment set</li>
        </ul>
      </details>
    </section>

    <!-- Inventory & Incentives Integration -->
    <section id="inventory" class="section">
      <h2>Inventory & Incentives Integration</h2>
      <p class="muted">AI reads live website inventory and OEM programs, then injects tokens into responses while keeping work inside VIN.</p>

      <div class="cards">
        <div class="card">
          <h3>Data & Endpoints</h3>
          <ul class="small">
            <li><strong>Inventory</strong>: <code>GET /inventory.json</code> (stock_number, vin, year, trim, status, price, photo, updated_at)</li>
            <li><strong>Incentives</strong>: <code>GET /incentives?make=&amp;model=&amp;zip=</code> (cash_rebate, apr, term, expiry)</li>
            <li><strong>Tokens</strong>: [[stock_count]], [[model_trim]], [[cash_rebate]], [[apr_rate]], [[two_appt_options]], [[primary_photo]]</li>
          </ul>
        </div>
        <div class="card">
          <h3>Event Flow</h3>
          <ol class="small">
            <li>New lead arrives in VIN</li>
            <li>AI pulls inventory + incentives</li>
            <li>Composes email/SMS (&lt;5 min) with two slots</li>
            <li>Logs Activity + creates Task/Appt in VIN</li>
            <li>Handles replies; sends confirmation/reminder</li>
          </ol>
        </div>
      </div>

      <details class="section">
        <summary>Open for more (fallbacks & SLAs)</summary>
        <div class="small" style="margin-top:8px">
          If inventory feed unreachable → serve cache ≤15 min & flag “stale”.  
          If incentives timeout → omit incentives line, keep the appointment CTA.  
          Price/availability mismatch → add “subject to prior sale” + closest alternative.
        </div>
      </details>
    </section>

    <!-- >>>>>> Live Tokens <<<<<< -->
    <section id="live-tokens" class="section">
      <h2>Live Tokens (Inventory & Incentives)</h2>
      <p class="muted">Pulls live feeds (or cache) to populate tokens the drafts will use.</p>

      <div class="cards">
        <div class="card">
          <h3>Token Preview</h3>
          <div class="small" id="tokenPreview">Awaiting selection…</div>
          <div class="small muted" id="tokenMeta" style="margin-top:6px"></div>
          <button id="refreshTokensBtn" class="btn small" style="margin-top:10px">Refresh Tokens</button>
        </div>
      </div>
    </section>
    <!-- >>>>>> END Live Tokens <<<<<< -->

    <!-- Desk Log Insights -->
    <section id="insights" class="section">
      <h2>Desk Log Insights (Snapshot)</h2>
      <p class="muted">Where automation helps most: faster first replies and auto-nudges when staff are busy.</p>

      <div class="cards">
        <div class="card">
          <h3>Funnel Summary</h3>
          <table class="table small" aria-label="Funnel summary">
            <thead><tr><th>Stage</th><th>Count</th><th>Conv from prior</th></tr></thead>
            <tbody>
              <tr><td>Leads Created</td><td>17</td><td>—</td></tr>
              <tr><td>Contacted</td><td>9</td><td>-47%</td></tr>
              <tr><td>Appointments Set</td><td>0</td><td>-100%</td></tr>
              <tr><td>Showroom Visits</td><td>0</td><td>—</td></tr>
              <tr><td>Deals</td><td>0</td><td>—</td></tr>
            </tbody>
          </table>
        </div>
        <div class="card">
          <h3>Response Time Buckets</h3>
          <table class="table small" aria-label="Response times">
            <thead><tr><th>Bucket</th><th>Count</th></tr></thead>
            <tbody>
              <tr><td>1–24 hrs</td><td>9</td></tr>
              <tr><td>No Attempt</td><td>8</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="callout small" style="margin-top:12px">
        <strong>Opportunity</strong>: Auto-compose within 5 minutes + 24/48-hour re-nudges + manager escalation at day 7 closes the gap from “contacted” to “appointments set.”
      </div>
    </section>

    <!-- Implementation Timeline -->
    <section id="timeline" class="section">
      <h2>Implementation Timeline</h2>
      <div class="cards">
        <div class="card">
          <h3>Phase 1: Discovery/Design (M1-2)</h3>
          <ul class="small">
            <li>Map BDC workflows; pick top 20–30 scenarios</li>
            <li>Draft templates; assemble AI training set</li>
          </ul>
        </div>
        <div class="card">
          <h3>Phase 2: Build/Pilot (M3-4)</h3>
          <ul class="small">
            <li>Email automation + VIN integration</li>
            <li>Pilot with small BDC group; track KPIs</li>
          </ul>
        </div>
        <div class="card">
          <h3>Phase 3: Full Email Deploy (M5)</h3>
          <ul class="small">
            <li>Roll to full team; monitor response speed & conversions</li>
            <li>Scope real-time phone prompts</li>
          </ul>
        </div>
        <div class="card">
          <h3>Phase 4-5: Expansion (M6-12)</h3>
          <ul class="small">
            <li>Phone assist + live inventory feeds</li>
            <li>Scale to additional rooftops; continuous improvement</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- >>>>>> Recent Agent Runs <<<<<< -->
    <section id="runs" class="section">
      <h2>Recent Agent Runs</h2>
      <p class="muted">Drafts saved from the Playground appear here. Later, point this at the Platform backend.</p>
      <div class="cards">
        <div class="card">
          <h3>Last 10</h3>
          <div id="runsTable" class="small">No runs yet.</div>
          <button id="reloadRunsBtn" class="btn small" style="margin-top:10px">Reload</button>
        </div>
      </div>
    </section>
    <!-- >>>>>> END Recent Agent Runs <<<<<< -->

    <!-- Downloads -->
    <section id="downloads" class="section">
      <h2>Downloads</h2>
      <p class="muted">Save or print one-pagers, training packets, and response libraries.</p>

      <div class="cards">
        <div class="card">
          <h3>Executive Summary — VIN vs Gen AI</h3>
          <p class="small">High-level comparison of current VIN workflow and the AI overlay.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/Executive_Summary_VIN_vs_GenAI.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Smart Response Library (Full — 20 Scenarios)</h3>
          <p class="small">Ready-to-use email, SMS, and call prompts for the BDC.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/BDC_Smart_Response_Library_Full.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Training Packet (AI vs VIN)</h3>
          <p class="small">Roleplay scripts and drills to drive appointment-setting.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/BDC_Training_Packet_v2.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Inventory Integration — One-Pager</h3>
          <p class="small">How live inventory & incentives flow into responses; VIN writebacks.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/GenAI_Inventory_Integration_OnePager_v3.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Project Plan</h3>
          <p class="small">Phases, milestones, success metrics, roles & responsibilities.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/BDC_Smart_Response_Project_Plan.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Desk Log Analysis (Snapshot)</h3>
          <p class="small">Funnel, response times, and lead source contact rates.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/desklog_analysis_summary.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Workflow Comparison (Slide or Image)</h3>
          <p class="small">Overview of VIN vs Gen AI process steps.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/VINS%20vs%20Gen%20AI%20Alternative%20summary.pdf">Open PDF</a></p>
        </div>

        <div class="card">
          <h3>Full Bundle (ZIP)</h3>
          <p class="small">All leadership-ready PDFs in one package.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/Quirk_AI_Project_PDFs.zip">Open ZIP</a></p>
        </div>

        <div class="card">
          <h3>FAQ</h3>
          <p class="small">Answers for managers and agents on rollout, KPIs, and workflow.</p>
          <p><a class="btn" target="_blank" rel="noopener" href="assets/Quirk_AI_VIN_GenAI_FAQ.pdf">Open PDF</a></p>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section">
      <h2>FAQ</h2>

      <details>
        <summary>Will AI replace our BDC agents?</summary>
        <div class="small" style="margin-top:8px">
          <p><strong>No.</strong> AI drafts, nudges, and keeps tasks moving; people build trust and close. The system removes repetitive work so agents can focus on live conversations and appointment-setting.</p>
          <p><strong>What AI handles</strong></p>
          <ul>
            <li>Composes personalized emails/SMS with inventory & incentives in under 5 minutes.</li>
            <li>Creates/updates VIN activities, tasks, and appointments so nothing slips.</li>
            <li>Sends 24/48-hour re-nudges and day-7 manager escalation, consistently.</li>
            <li>Provides real-time talk tracks for common objections.</li>
          </ul>
          <p><strong>What agents do</strong></p>
          <ul>
            <li>Approve/modify outbound messages as needed and make the calls.</li>
            <li>Handle pricing nuance, trade-value conversations, and relationship building.</li>
            <li>Confirm appointment details, coordinate vehicles, and close for the show.</li>
          </ul>
        </div>
      </details>

      <details>
        <summary>Does everything stay inside VIN Solutions?</summary>
        <div class="small" style="margin-top:8px">
          <p><strong>Yes—VIN remains the system of record.</strong> The AI layer writes back every interaction so reporting and accountability live in one place.</p>
          <ul>
            <li><strong>Activities:</strong> full message body (HTML note), who/when, and tokens used.</li>
            <li><strong>Tasks:</strong> auto-created follow-ups with due dates to maintain compliance.</li>
            <li><strong>Appointments:</strong> proposed times and confirmed start/end once the customer accepts.</li>
          </ul>
        </div>
      </details>

      <details>
        <summary>How do incentives and inventory stay accurate?</summary>
        <div class="small" style="margin-top:8px">
          <p>Live data with sensible fallbacks: if feeds are missing, the message omits specifics and keeps the appointment CTA; cache ≤15 minutes if inventory is unreachable.</p>
        </div>
      </details>
    </section>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <small>© 2025 Quirk AI — VIN Gen AI Alternative</small>
  </footer>

  <!-- ====================== SCRIPTS ====================== -->

  <!-- Step 1: Agent Playground script -->
  <script>
  /* -------- Agent Playground: front-end generator with backend-ready cURL -------- */
  const API_BASE = ""; // later: "https://your-platform.example.com" (FastAPI)
  const OEM_TTL_MS = 15 * 60 * 1000; // 15 minutes

  /* Intent classifier expanded to catch "rebates/offers/APR/lease" */
  function classifyLeadText(lead) {
    const t = String(lead || "").toLowerCase();
    if (/(rebate|incentive|offer|program|apr|lease)/.test(t)) return "offers_question";
    if (/(trade|trade-in|appraisal|value|kbb|carvana|carmax)/.test(t)) return "trade_in";
    if (/(best price|price quote|out the door|otd|lowest|payment)/i.test(t)) return "best_price";
    if (/(just looking|just shopping|browsing|compare|research)/i.test(t)) return "just_shopping";
    if (/(available|in stock|inventory|color|trim|option)/i.test(t)) return "new_inventory";
    return "new_inventory";
  }

  function tonePreset() { return { opener: "Hi", closer: "— Quirk BDC" }; }

  function buildMessage({ scenario, tokens, model, name, twoSlots, channel, meta }) {
    const { opener, closer } = tonePreset();
    const greeting = `${opener} ${name || "there"},`;

    const inventoryLine =
      `We currently have ${tokens.stock_count ?? "several"} ${model} in stock including ${tokens.model_trim ?? "popular trims"}.`;

    const incentivesBits = [];
    if (tokens.cash_rebate) incentivesBits.push(tokens.cash_rebate);
    if (tokens.apr_rate)    incentivesBits.push(tokens.apr_rate);
    const incentivesLine = incentivesBits.length ? `This week: ${incentivesBits.join(" + ")}.` : "";

    const offersAck = incentivesBits.length
      ? `Great question on current offers — ${incentivesBits.join(" + ")} for well-qualified customers.`
      : `Great question on current offers — I’ll pull the exact programs for your ZIP and eligibility.`;

    const copyMap = {
      offers_question: `${offersAck} Would ${twoSlots[0]} or ${twoSlots[1]} work to go over details and take a quick drive?`,
      new_inventory:   `Would ${twoSlots[0]} or ${twoSlots[1]} work for a quick drive? I can have one ready.`,
      best_price:      `I can show current programs side-by-side on a vehicle you can drive. Would ${twoSlots[0]} or ${twoSlots[1]} work for a quick visit?`,
      just_shopping:   `No pressure—15 minutes is enough to compare trims in person. Would ${twoSlots[0]} or ${twoSlots[1]} work?`,
      trade_in:        `Bring your keys and we’ll give you a firm number in about 20 minutes. Does ${twoSlots[0]} or ${twoSlots[1]} work?`,
    };
    const copy = copyMap[scenario] || copyMap.new_inventory;

    const disclaimer = channel === "email"
      ? `\n\nPricing/availability subject to prior sale. Incentives subject to eligibility; see dealer for details.`
      : "";

    // Optional source link (email only)
    const srcLink = (channel === "email" && meta?.oem_source)
      ? `\nSource: GM Financial current offers — ${meta.oem_source}`
      : "";

    if (channel === "sms") {
      return `${greeting} ${inventoryLine} ${incentivesLine} ${copy}`;
    }
    return `${greeting}\n\n${inventoryLine}${incentivesLine ? "\n" + incentivesLine : ""}\n\n${copy}\n\n${closer}${disclaimer}${srcLink}`;
  }

  function extractName(lead) {
    const m = (lead || "").match(/name[:\-]?\s*([A-Z][a-z]+)\b/mi);
    return m ? m[1] : null;
  }

  // simple two-slot generator (you can swap for the smarter business-hours version later)
  function generateTwoApptOptions() {
    if (window.__apptOptions?.suggest) return window.__apptOptions.suggest();
    const now = new Date();
    const thurs = nextDowAt(now, 4, 18, 15);
    const sat   = nextDowAt(now, 6, 10, 30);
    return [fmt(thurs), fmt(sat)];
  }
  function nextDowAt(base, dow, hh, mm) { const d = new Date(base); const diff = (dow - d.getDay() + 7) % 7 || 7; d.setDate(d.getDate() + diff); d.setHours(hh, mm, 0, 0); return d; }
  function fmt(d) { return d.toLocaleString(undefined, { weekday:"long", hour:"numeric", minute:"2-digit" }); }

  async function composeDraftFrontEnd({ lead, make, model, zip, offersZip, channel }) {
    // Pull full payload (tokens + meta) from Step 2
    const full = await window.__inventoryTokens?.getFull({ make, model, zip, offersZip }).catch(() => null);
    const tokens = full?.tokens || {};
    const meta   = full?.meta   || {};

    const twoSlots = generateTwoApptOptions();
    const scenario = classifyLeadText(lead);
    const name     = extractName(lead);

    const text = buildMessage({ scenario, tokens, model, name, twoSlots, channel, meta });

    return { text, tokens: { ...tokens, two_appt_options: twoSlots, scenario } };
  }

  function setOemHealthBadge(state) {
    const el = document.getElementById('oemHealthBadge');
    if (!el) return;
    el.classList.remove('ok','stale','missing');
    if (state === 'ok') { el.classList.add('ok'); el.textContent = 'OEM: OK'; }
    else if (state === 'stale') { el.classList.add('stale'); el.textContent = 'OEM: Stale'; }
    else { el.classList.add('missing'); el.textContent = 'OEM: Missing'; }
  }

  document.getElementById('composeBtn')?.addEventListener('click', async () => {
    const lead = document.getElementById('leadText').value.trim();
    const make = document.getElementById('make').value.trim();
    const model = document.getElementById('model').value.trim();
    const zip = document.getElementById('zip').value.trim();
    const offersZip = document.getElementById('offersZip').value.trim() || zip;
    const channel = document.getElementById('channel').value;

    const { text, tokens } = await composeDraftFrontEnd({ lead, make, model, zip, offersZip, channel });
    document.getElementById('draftPane')..textContent = text;

    const payload = JSON.stringify({ lead, make, model, zip, offersZip, channel, tokens }, null, 2);
    const curl = API_BASE
      ? `curl -X POST '${API_BASE}/api/compose' -H 'Content-Type: application/json' -d '${payload.replace(/\n/g,"")}'`
      : `# When your AutoGPT Platform is up, set API_BASE and use:\n# curl -X POST '$API_BASE/api/compose' -H 'Content-Type: application/json' -d '${payload.replace(/\n/g,"")}'`;
    document.getElementById('curlBlock').textContent = curl;
  });

  document.getElementById('copyDraftBtn')?.addEventListener('click', async () => {
    const text = document.getElementById('draftPane').textContent;
    if (!text) return;
    await navigator.clipboard.writeText(text);
    alert('Draft copied to clipboard.');
  });

  document.getElementById('saveRunBtn')?.addEventListener('click', () => {
    const draft = document.getElementById('draftPane').textContent;
    if (!draft) return;
    const runs = JSON.parse(localStorage.getItem('agent_runs') || '[]');
    const run = { id: 'run_' + Date.now(), status: 'drafted', created_at: new Date().toISOString(), channel: document.getElementById('channel').value, preview: draft.slice(0,180) + (draft.length>180?'…':'' ) };
    runs.unshift(run);
    localStorage.setItem('agent_runs', JSON.stringify(runs));
    window.dispatchEvent(new Event('agent_runs_updated'));
  });
  </script>

  <!-- Step 2: Inventory & Incentives token service (with OEM offers & preview upgrades) -->
  <script>
  (function(){
    const CACHE_KEY = 'inv_tokens_cache_v2';
    const TTL_MS = 15 * 60 * 1000;

    // If you used workers.dev, set this to your Worker URL. If you routed /api/oem-offers to the Worker, leave relative.
    const OEM_ENDPOINT = '/api/oem-offers';

    async function fetchJson(url, opts) {
      const res = await fetch(url, opts);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    async function computeTokens({ make, model, zip, offersZip }) {
      let inventory=[], incentives=null, oemOffers=null, sourceNotes=[];
      try {
        inventory = await fetchJson('inventory.json');
        sourceNotes.push('inventory:live');
      } catch { sourceNotes.push('inventory:missing'); }

      // OEM offers (GM Financial) via Cloudflare Worker
      try {
        const q = new URLSearchParams({ make, model, zip: offersZip || zip }).toString();
        oemOffers = await fetchJson(`${OEM_ENDPOINT}?${q}`);
        sourceNotes.push('oem:gmfinancial');
      } catch { sourceNotes.push('oem:gmfinancial:missing'); }

      // Optional local incentives fallback
      try {
        incentives = await fetchJson(`incentives.json?make=${encodeURIComponent(make)}&model=${encodeURIComponent(model)}&zip=${encodeURIComponent(zip)}`);
        sourceNotes.push('incentives:local');
      } catch { sourceNotes.push('incentives:local:missing'); }

      const list = (inventory || []).filter(v =>
        (!make || ciEq(v.make, make)) && (!model || ciEq(v.model, model)) && (!v.status || v.status.toLowerCase() !== 'sold')
      );
      const stockCount = list.length;
      const first = list[0] || {};
      const trim = first.trim || 'popular trims';

      // prefer OEM, then local
      const cash = oemOffers?.cash_rebate
        ?? (incentives?.cash_rebate ? `$${Number(incentives.cash_rebate).toLocaleString()} customer cash` : null);
      const apr = (oemOffers?.apr != null)
        ? `${oemOffers.apr}% APR`
        : (incentives?.apr ? `${incentives.apr}% APR` : null);

      const lease = oemOffers?.lease || null;

      return {
        tokens: {
          stock_count: stockCount || undefined,
          model_trim: trim,
          cash_rebate: cash || undefined,
          apr_rate: apr || undefined,
          lease_monthly: lease?.monthly || undefined,
          lease_due: lease?.due_at_signing || undefined,
          lease_months: lease?.months || undefined,
          primary_photo: first.photo || undefined
        },
        meta: {
          sourceNotes,
          updated_at: first.updated_at || null,
          oem_source: oemOffers?.source || null,
          fetched_at: oemOffers?.fetched_at || null
        }
      };
    }

    function ciEq(a,b){ return String(a||'').toLowerCase() === String(b||'').toLowerCase(); }

    async function get({ make, model, zip, offersZip }) {
      const now = Date.now();
      const key = `${make}|${model}|${zip}|${offersZip||''}`;
      const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null');
      if (cached && (now - cached.ts) < TTL_MS && cached.key === key) return cached.payload;
      const payload = await computeTokens({ make, model, zip, offersZip });
      localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: now, key, payload }));
      return payload;
    }

    function renderPreview(payload) {
      const { tokens, meta } = payload || {};
      const el = document.getElementById('tokenPreview');
      const metaEl = document.getElementById('tokenMeta');
      if (!tokens) { el.textContent = 'No tokens available.'; return; }
      el.innerHTML = `
        <code>[[stock_count]]</code>: ${tokens.stock_count ?? '—'} &nbsp;|&nbsp;
        <code>[[model_trim]]</code>: ${tokens.model_trim ?? '—'} &nbsp;|&nbsp;
        <code>[[cash_rebate]]</code>: ${tokens.cash_rebate ?? '—'} &nbsp;|&nbsp;
        <code>[[apr_rate]]</code>: ${tokens.apr_rate ?? '—'}<br>
        <code>lease</code>: ${tokens.lease_monthly ? ('$' + tokens.lease_monthly + '/mo, $' + (tokens.lease_due||0).toLocaleString() + ' DAS, ' + (tokens.lease_months||'—') + ' mo') : '—'}
      `;
      const stale = isStale();
      metaEl.innerHTML = `${(meta?.sourceNotes||[]).join(', ')}${stale ? ' • cache ≤15m' : ''}${meta?.updated_at ? ' • inv updated ' + meta.updated_at : ''}${
        meta?.oem_source ? ' • <a href="'+meta.oem_source+'" target="_blank" rel="noopener">GM Financial source</a>' : ''
      }`;
      metaEl.style.color = stale ? '#b45309' : '#475569';

      // update the small OEM health badge
      const state = getOemHealthState(meta);
      if (state) window.__setOemHealth && window.__setOemHealth(state);
    }

    function isStale() {
      const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null');
      if (!cached) return true;
      return (Date.now() - cached.ts) >= TTL_MS;
    }

    function getOemHealthState(meta) {
      if (!meta?.oem_source || !meta?.fetched_at) return 'missing';
      const age = Date.now() - new Date(meta.fetched_at).getTime();
      if (age <= TTL_MS) return 'ok';
      return 'stale';
    }

    // public APIs
    window.__inventoryTokens = {
      // tokens only
      get: async ({ make, model, zip, offersZip }) => get({ make, model, zip, offersZip }).then(p => p.tokens),
      // full payload (tokens + meta)
      getFull: async ({ make, model, zip, offersZip }) => get({ make, model, zip, offersZip })
    };

    // expose badge setter for Step 1
    window.__setOemHealth = (state) => {
      const el = document.getElementById('oemHealthBadge');
      if (!el) return;
      el.classList.remove('ok','stale','missing');
      if      (state === 'ok')     { el.classList.add('ok'); el.textContent = 'OEM: OK'; }
      else if (state === 'stale')  { el.classList.add('stale'); el.textContent = 'OEM: Stale'; }
      else                         { el.classList.add('missing'); el.textContent = 'OEM: Missing'; }
    };

    async function refreshFromInputs() {
      const make = document.getElementById('make')?.value || '';
      const model = document.getElementById('model')?.value || '';
      const zip = document.getElementById('zip')?.value || '';
      const offersZip = document.getElementById('offersZip')?.value || zip;
      const payload = await get({ make, model, zip, offersZip });
      renderPreview(payload);
    }

    document.getElementById('refreshTokensBtn')?.addEventListener('click', refreshFromInputs);
    ['make','model','zip','offersZip'].forEach(id => {
      const el = document.getElementById(id);
      el && el.addEventListener('change', refreshFromInputs);
    });

    // initial health badge
    window.__setOemHealth && window.__setOemHealth('missing');
  })();
  </script>

  <!-- Step 3: Run Log Viewer (localStorage today, API tomorrow) -->
  <script>
  (async function(){
    const API_BASE = ""; // later: "https://your-platform.example.com"
    async function loadRuns() {
      if (API_BASE) {
        try {
          const r = await fetch(`${API_BASE}/api/runs?limit=10`);
          if (!r.ok) throw new Error('Failed to load runs');
          return (await r.json()).runs || [];
        } catch { /* fall through to local */ }
      }
      const local = JSON.parse(localStorage.getItem('agent_runs') || '[]');
      return local.slice(0, 10);
    }

    function statusBadge(s) {
      const color = s === 'succeeded' ? '#065f46' : s === 'failed' ? '#b91c1c' : '#334155';
      return `<span style="border:1px solid ${color};color:${color};padding:2px 6px;border-radius:999px">${s}</span>`;
    }

    async function render() {
      const runs = await loadRuns();
      const el = document.getElementById('runsTable');
      if (!runs.length) { el.textContent = 'No runs yet.'; return; }
      el.innerHTML = `
        <table class="table">
          <thead><tr><th>When</th><th>Status</th><th>Channel</th><th>Preview</th><th>Actions</th></tr></thead>
          <tbody>
            ${runs.map(r => `
              <tr>
                <td>${new Date(r.created_at).toLocaleString()}</td>
                <td>${statusBadge(r.status || 'drafted')}</td>
                <td>${r.channel || '—'}</td>
                <td>${(r.preview || '').replace(/</g,'&lt;')}</td>
                <td>
                  <button class="btn small" data-run="${r.id}" data-action="copy">Copy ID</button>
                  <button class="btn small" data-run="${r.id}" data-action="rerun">Re-run</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    document.getElementById('reloadRunsBtn')?.addEventListener('click', render);
    document.getElementById('runsTable')?.addEventListener('click', async (e) => {
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const id = btn.getAttribute('data-run');
      const action = btn.getAttribute('data-action');
      if (action === 'copy') {
        await navigator.clipboard.writeText(id);
        alert('Run ID copied.');
      } else if (action === 'rerun') {
        alert('In a real backend, this would POST /api/runs/{id}/rerun.');
      }
    });

    window.addEventListener('agent_runs_updated', render);
    render();
  })();
  </script>
  <!-- ==================== END SCRIPTS ==================== -->

</body>
</html>
