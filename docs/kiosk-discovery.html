<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kiosk — Discovery</title>

  <base href="/Quirk-AI-Project-Overview/"/>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :focus-visible { outline: 2px solid #34d399; outline-offset: 2px; }
    body { background: transparent; }

    /* ===== No inner scrollbars; let page grow naturally ===== */
    html, body { height: auto; overflow: visible !important; }
    #discoveryShell, #discoveryCard, #discoveryCard .card-body {
      max-height: none !important;
      overflow: visible !important;
    }

    /* Inputs */
    .field-label{display:block;font-size:.875rem;font-weight:600;color:#334155;margin-bottom:.25rem}
    .field-input{border:1px solid #e5e7eb;border-radius:.75rem;padding:.75rem;background:#fff}
    .field-input:focus{outline:2px solid #10b981;outline-offset:2px}
    .field-input.w-full{width:100%} /* only full-width when explicitly requested */

    /* Compact widths (tuned to your markups) */
    .w-model     { width: 34ch !important; }
    .w-cab       { width: 20ch !important; }
    .w-use       { width: 28ch !important; }     /* 1) shorten Primary use */
    .w-towing    { width: 22ch !important; }
    .w-seating   { width: 8ch  !important; }
    .w-fuel      { width: 12ch !important; }
    .w-invest    { width: 25ch !important; }     /* 2) add ~3ch to Initial Investment */
    .w-budget    { width: 18ch !important; }     /* centered column */
    .w-lease     { width: 24ch !important; }     /* 4) “Show me lease specials” box */
    .w-payoff    { width: 22ch !important; }
    .w-condition { width: 40ch !important; }     /* 5) Vehicle condition */

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
    input[type="number"]{ -moz-appearance: textfield; }

    /* ===== First row behavior =====
       Default: single column, centered (vehicle centered)
       When Silverado selected: .two-cols -> two columns (vehicle left, cab right) */
    #firstRow{
      display:grid;
      grid-template-columns: 1fr;
      justify-content:center;
      gap:1rem;
      align-items:end;
    }
    #firstRow > *{ justify-self:center; }
    #firstRow.two-cols{
      grid-template-columns: auto auto;
      justify-content:center;
      align-items:end;
    }
    #firstRow.two-cols > *{ justify-self:start; }

    /* Section title */
    .section-title{
      text-align:center;color:#065f46;font-weight:800;
      font-size:1.25rem;margin-top:1.25rem;margin-bottom:.25rem;
      border:0 !important;
    }
    .section-title::before,
    .section-title::after{ content:none !important; display:none !important; }

    .subtle { color:#64748b }

    /* Currency inputs */
    .currency { padding-left: 2.5rem; }
    .currency.tight { padding-left: 2.25rem; }

    /* Center CTA */
    .cta { display:flex; justify-content:center; }
  </style>
</head>
<body class="p-2">
  <div id="discoveryShell" class="max-w-4xl mx-auto">
    <div id="discoveryCard" class="rounded-2xl border border-slate-200 shadow bg-white/95 p-4 sm:p-6">
      <h2 class="text-center text-xl sm:text-2xl font-bold text-emerald-800">Discovery</h2>
      <p class="text-center text-slate-600 mt-1">Answer a few questions so we can match the right vehicle.</p>

      <!-- FORM -->
      <form id="discForm" class="mt-5 grid gap-5">
        <!-- Row 1: Vehicle (center by default). Cab shows to the right only for Silverado -->
        <div id="firstRow">
          <label id="modelWrap" class="block">
            <span class="field-label">Vehicle you’re interested in</span>
            <select id="model" class="field-input w-model"></select>
          </label>

          <label id="cabWrap" class="block hidden">
            <span class="field-label">Cab style (Silverado)</span>
            <select id="cab" class="field-input w-cab">
              <option value="">Any</option>
              <option>Regular Cab</option>
              <option>Double Cab</option>
              <option>Crew Cab</option>
            </select>
          </label>
        </div>

        <!-- Row 2: Primary use + Tow (Primary use shortened) -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Primary use</span>
            <select id="use" class="field-input w-use">
              <option>Daily commute</option>
              <option>Family / kids</option>
              <option>Work / jobsite</option>
              <option>Hauling / towing</option>
              <option>Adventure / outdoors</option>
              <option>Luxury / performance</option>
            </select>
          </label>

          <label class="block">
            <span class="field-label">Tow Capacity needed</span>
            <select id="towing" class="field-input w-towing">
              <option>None</option>
              <option>Light (≤ 3,500 lbs)</option>
              <option>Medium (3,500–7,500 lbs)</option>
              <option>Heavy (≥ 7,500 lbs)</option>
            </select>
          </label>
        </div>

        <!-- Row 3: Seating + Fuel -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Preferred seating</span>
            <select id="seating" class="field-input w-seating">
              <option>2</option>
              <option selected>5</option>
              <option>6–7</option>
              <option>8+</option>
            </select>
          </label>

          <label class="block">
            <span class="field-label">Fuel type</span>
            <select id="fuel" class="field-input w-fuel">
              <option selected>Gasoline</option>
              <option>Diesel</option>
              <option>Hybrid</option>
              <option>Plug-in Hybrid</option>
              <option>Electric</option>
            </select>
          </label>
        </div>

        <!-- Row 4: Investment + Budget + Lease specials -->
        <div class="grid md:grid-cols-3 gap-4">
          <!-- Left: Initial Investment (wider by ~3ch) -->
          <label class="block">
            <span class="field-label">Initial Investment (approx)</span>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
              <input id="downPayment" type="text"
                     class="field-input currency w-invest"
                     placeholder="    20% down recommended "/>
            </div>
          </label>

          <!-- Center: Monthly budget (centered column) -->
          <label class="block justify-self-center">
            <span class="field-label">What is your monthly budget?</span>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
              <input id="budget" type="text"
                     class="field-input currency tight w-budget"
                     value="650.00"/>
            </div>
          </label>

          <!-- Right: Show me lease specials (Yes/No) -->
          <label class="block">
            <span class="field-label">Show me lease specials</span>
            <select id="leaseSpecials" class="field-input w-lease">
              <option>No</option>
              <option>Yes</option>
            </select>
          </label>
        </div>

        <!-- Vehicle you’re replacing -->
        <h3 class="section-title">Vehicle you’re replacing</h3>
        <p class="text-center subtle -mt-2">Tell us about the vehicle you’re trading in.</p>

        <!-- Row 5: Year / Make / Model / Estimated payoff -->
        <div class="grid md:grid-cols-4 gap-4">
          <label class="block">
            <span class="field-label">Year</span>
            <select id="tradeYear" class="field-input w-full"></select>
          </label>

          <label class="block">
            <span class="field-label">Make</span>
            <input id="tradeMake" type="text" class="field-input w-full" placeholder="e.g., Chevrolet"/>
          </label>

          <label class="block">
            <span class="field-label">Model</span>
            <input id="tradeModel" type="text" class="field-input w-full" placeholder="e.g., Equinox"/>
          </label>

          <label class="block">
  <span class="field-label">Estimated payoff</span>
  <div class="relative">
    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
    <input
      id="payoff"
      type="text"
      class="field-input currency w-payoff placeholder-slate-400"
      style="padding-left:1.6rem"   <!-- nudges value close to the $; tweak ±0.1rem if needed -->
      placeholder="0.00"
    />
  </div>
</label>

          <!-- Row 5b: Financed with (align under Estimated payoff, same width) -->
          <label class="block md:col-start-4">
            <span class="field-label">Who are you financed with?</span>
            <input id="financedWith" type="text" class="field-input w-payoff" placeholder="e.g., GM Financial"/>
          </label>
        </div>

        <!-- Row 6: Current mileage + Vehicle condition -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Current mileage</span>
            <input id="miles" type="text" maxlength="8" class="field-input w-[16ch]" placeholder="Enter miles"/>
          </label>

          <label class="block">
            <span class="field-label">Vehicle condition</span>
            <select id="vehicleCondition" class="field-input w-condition">
              <option>Grade 5 – Vehicle in excellent condition.</option>
              <option>Grade 4 – Vehicle is better than average.</option>
              <option selected>Grade 3 – Normal wear and tear.</option>
              <option>Grade 2 – Shows signs of excessive wear and tear.</option>
              <option>Grade 1 – Shows signs of severe abuse.</option>
              <option>Grade 0 – Vehicle is inoperative.</option>
            </select>
          </label>
        </div>

        <!-- Actions -->
        <div class="cta pt-2">
          <button type="button" id="backBtn" class="px-4 py-2 rounded-xl border bg-white/90 mr-3">← Back</button>
          <button type="submit" class="px-5 py-3 rounded-2xl bg-emerald-600 text-white font-semibold shadow hover:brightness-110">
            Pick a vehicle
          </button>
        </div>
      </form>
    </div>
  </div>

<script>
/* ---------------- helpers ---------------- */
const $ = (id) => document.getElementById(id);
const save = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

function formatMoney(val){
  const n = Number(val || 0);
  return n.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
}
function parseMoney(str){
  return Number(String(str || "0").replace(/[^\d.]/g,'') || 0);
}

/* ---------------- elements ---------------- */
const firstRow  = $('firstRow');
const modelEl   = $('model');
const cabWrap   = $('cabWrap');
const cabEl     = $('cab');

const useEl     = $('use');
const towingEl  = $('towing');
const seatingEl = $('seating');
const fuelEl    = $('fuel');

const downEl    = $('downPayment');
const budgetEl  = $('budget');
const leaseEl   = $('leaseSpecials');

const tradeYear = $('tradeYear');
const tradeMake = $('tradeMake');
const tradeModel= $('tradeModel');
const payoffEl  = $('payoff');
const financedWithEl = $('financedWith');
const milesEl   = $('miles');
const vehicleConditionEl = $('vehicleCondition');

const form      = $('discForm');
const backBtn   = $('backBtn');

/* ------------- data ------------- */
const RAW_MODELS = [
  'Blazer','Colorado','Corvette E-Ray','Corvette Stingray','Equinox',
  'Express Cargo 2500','Express Cargo 3500','Express Cutaway 3500',
  'Low Cab Forward 4500','Low Cab Forward 4500 HD','Low Cab Forward 5500 HD','Low Cab Forward 6500 HD',
  'Silverado 1500','Silverado 2500 HD','Silverado 3500 HD','Silverado 3500 HD Chassis Cab',
  'Silverado 4500 HD','Silverado 5500 HD','Silverado 6500 HD','Silverado EV',
  'Suburban','Tahoe','Trailblazer','Traverse','Trax'
];
function customSort(a,b){
  const weight = (name) => name.startsWith('Corvette') ? 0 : (name === 'Trax' ? 2 : 1);
  const wa = weight(a), wb = weight(b);
  if (wa !== wb) return wa - wb;
  return a.localeCompare(b);
}
const MODELS = [...RAW_MODELS].sort(customSort);

function isSilverado(model){ return /^Silverado\s(1500|2500|3500)/.test(model); }

/* ------------- init lists ------------- */
function fillModels(){
  modelEl.innerHTML = MODELS.map(m => `<option>${m}</option>`).join('');
}
function fillYears(){
  const thisYear = new Date().getFullYear();
  const start = 1990;
  const opts = [`<option value="" selected disabled>Select Year</option>`];
  for(let y=thisYear; y>=start; y--) opts.push(`<option>${y}</option>`);
  tradeYear.innerHTML = opts.join('');
}

/* ------------- Silverado layout toggle ------------- */
function updateCabVisibility(){
  const showCab = isSilverado(modelEl.value || '');
  cabWrap.classList.toggle('hidden', !showCab);
  firstRow.classList.toggle('two-cols', showCab);
}

/* ------------- fresh defaults ------------- */
function setFreshDefaults(){
  budgetEl.value = formatMoney(650);
  payoffEl.value = formatMoney(0);
  downEl.value   = "";
  milesEl.value  = "";
  leaseEl.value  = "No";
}

/* ------------- persistence ------------- */
function persist(){
  const data = {
    model: modelEl.value,
    cab: cabEl.value,
    use: useEl.value,
    towing: towingEl.value,
    seating: seatingEl.value,
    fuel: fuelEl.value,
    downPayment: parseMoney(downEl.value),
    budget: parseMoney(budgetEl.value),
    leaseSpecials: leaseEl.value,                  // NEW
    tradeYear: tradeYear.value || null,
    tradeMake: tradeMake.value || null,
    tradeModel: tradeModel.value || null,
    payoff: parseMoney(payoffEl.value),
    financedWith: financedWithEl.value || "",      // NEW
    miles: milesEl.value ? Number(String(milesEl.value).replace(/[^\d]/g,'')) : null,
    vehicleCondition: vehicleConditionEl.value     // NEW
  };
  try { localStorage.setItem('guided_needs', JSON.stringify(data)); } catch {}
  window.parent?.postMessage({ type: 'discovery:update', payload: { budget: data.budget, model: data.model } }, '*');
}

/* ------------- currency behavior ------------- */
function attachCurrency(el){
  el.addEventListener('blur', () => { el.value = formatMoney(parseMoney(el.value)); persist(); });
  el.addEventListener('input', () => { persist(); });
}
[downEl, budgetEl, payoffEl].forEach(attachCurrency);

/* ------------- events ------------- */
[modelEl, cabEl, useEl, towingEl, seatingEl, fuelEl, tradeYear, tradeMake, tradeModel,
 milesEl, vehicleConditionEl, financedWithEl, leaseEl]
  .forEach(el => el.addEventListener('input', persist));

modelEl.addEventListener('change', () => { updateCabVisibility(); persist(); });

backBtn.addEventListener('click', () => {
  window.parent?.postMessage({ type: 'discovery:back' }, '*');
});
form.addEventListener('submit', (e) => {
  e.preventDefault();
  persist();
  window.parent?.postMessage({ type: 'discovery:done' }, '*');
});

/* ------------- auto-report height to parent (helps kill the iframe scrollbar) ------------- */
function sendHeight(){
  const h = document.documentElement.scrollHeight;
  window.parent?.postMessage({ type: 'discovery:height', payload: { height: h } }, '*');
}
window.addEventListener('load', sendHeight);
new ResizeObserver(sendHeight).observe(document.documentElement);

/* ------------- boot ------------- */
fillModels();
fillYears();
updateCabVisibility();
setFreshDefaults();
persist();
sendHeight();
</script>
</body>
</html>
