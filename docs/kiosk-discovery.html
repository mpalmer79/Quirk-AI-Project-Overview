<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kiosk — Discovery</title>

  <base href="/Quirk-AI-Project-Overview/"/>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :focus-visible { outline: 2px solid #34d399; outline-offset: 2px; }
    body { background: transparent; }

    /* Generic field styling (no @apply so it works without a build step) */
    .field-label{display:block;font-size:.875rem;font-weight:600;color:#334155;margin-bottom:.25rem}
    .field-input{width:100%;border:1px solid #e5e7eb;border-radius:.75rem;padding:.75rem;background:#fff}
    .field-input:focus{outline:2px solid #10b981;outline-offset:2px}

    /* Hide number spinners where we still use type=number anywhere */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
    input[type="number"]{ -moz-appearance: textfield; }

    /* Compact widths requested */
    .w-seating   { width: 8ch; }     /* “5”, “6–7”, “8+” fit snugly */
    .w-fuel      { width: 12ch; }    /* just a bit wider than “Gasoline” */
    .w-invest    { width: 28ch; }    /* Initial Investment box */
    .w-budget    { width: 26ch; }    /* Monthly budget box */
    .w-payoff    { width: 22ch; }    /* Estimated payoff a bit wider */

    /* Center the first row’s “Vehicle you’re interested in” nicely */
    .first-row { grid-template-columns: 1fr; }
    @media (min-width: 900px){ .first-row { grid-template-columns: 1fr 1fr; } }

    /* Section title to match the green “Discovery” style */
    .section-title{
      text-align:center;color:#065f46;font-weight:800;
      font-size:1.25rem;margin-top:1.25rem;margin-bottom:.25rem;
    }
    .subtle { color:#64748b }

    /* Currency inputs: leave room after the $ and tweak paddings as requested */
    .currency { padding-left: 2.5rem; }       /* base left padding (pl-10) */
    .currency.tight { padding-left: 2.25rem; }/* a touch less (pl-9) */

    /* Keep the green CTA centered and without any arrow graphic */
    .cta { display:flex; justify-content:center; }
  </style>
</head>
<body class="p-2">
  <div class="max-w-4xl mx-auto">
    <div class="rounded-2xl border border-slate-200 shadow bg-white/95 p-4 sm:p-6">
      <h2 class="text-center text-xl sm:text-2xl font-bold text-emerald-800">Discovery</h2>
      <p class="text-center text-slate-600 mt-1">Answer a few questions so we can match the right vehicle.</p>

      <!-- FORM -->
      <form id="discForm" class="mt-5 grid gap-5">
        <!-- Row: Vehicle of interest (centered row) -->
        <div class="grid first-row gap-4 items-end place-items-center md:place-items-stretch">
          <label class="block w-full md:w-auto">
            <span class="field-label">Vehicle you’re interested in</span>
            <select id="model" class="field-input"></select>
          </label>

          <label id="cabWrap" class="block hidden w-full md:w-auto">
            <span class="field-label">Cab style (Silverado)</span>
            <select id="cab" class="field-input w-[18ch]">
              <option value="">Any</option>
              <option>Regular Cab</option>
              <option>Double Cab</option>
              <option>Crew Cab</option>
            </select>
          </label>
        </div>

        <!-- Row: Primary use + Tow capacity -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Primary use</span>
            <select id="use" class="field-input">
              <option>Daily commute</option>
              <option>Family / kids</option>
              <option>Work / jobsite</option>
              <option>Hauling / towing</option>
              <option>Adventure / outdoors</option>
              <option>Luxury / performance</option>
            </select>
          </label>

          <label class="block">
            <span class="field-label">Tow Capacity needed</span>
            <select id="towing" class="field-input w-[22ch]">
              <option>None</option>
              <option>Light (≤ 3,500 lbs)</option>
              <option>Medium (3,500–7,500 lbs)</option>
              <option>Heavy (≥ 7,500 lbs)</option>
            </select>
          </label>
        </div>

        <!-- Row: Seating + Fuel type (both trimmed) -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Preferred seating</span>
            <select id="seating" class="field-input w-seating">
              <option>2</option>
              <option selected>5</option>
              <option>6–7</option>
              <option>8+</option>
            </select>
          </label>

          <label class="block">
            <span class="field-label">Fuel type</span>
            <select id="fuel" class="field-input w-fuel">
              <option selected>Gasoline</option>
              <option>Diesel</option>
              <option>Hybrid</option>
              <option>Plug-in Hybrid</option>
              <option>Electric</option>
            </select>
          </label>
        </div>

        <!-- Row: Investment + Budget (compact, paddings adjusted) -->
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="field-label">Initial Investment (approx)</span>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
              <input id="downPayment" type="text"
                     class="field-input currency w-invest"
                     placeholder="  20% recommended downpayment"/>
            </div>
          </label>

          <label class="block">
            <span class="field-label">What is your monthly budget?</span>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
              <input id="budget" type="text"
                     class="field-input currency tight w-budget"
                     value="650.00"/>
            </div>
          </label>
        </div>

        <!-- ===== Vehicle you're replacing (centered heading like Discovery) ===== -->
        <h3 class="section-title">Vehicle you’re replacing</h3>
        <p class="text-center subtle -mt-2">Tell us a bit about the one you’re trading.</p>

        <!-- Trade details -->
        <div class="grid md:grid-cols-4 gap-4">
          <label class="block">
            <span class="field-label">Year</span>
            <select id="tradeYear" class="field-input">
              <!-- options filled by JS; first option will be “Select Year” -->
            </select>
          </label>

          <label class="block">
            <span class="field-label">Make</span>
            <input id="tradeMake" type="text" class="field-input" placeholder="e.g., Chevrolet"/>
          </label>

          <label class="block">
            <span class="field-label">Model</span>
            <input id="tradeModel" type="text" class="field-input" placeholder="e.g., Equinox"/>
          </label>

          <label class="block">
            <span class="field-label">Estimated payoff</span>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 select-none">$</span>
              <input id="payoff" type="text" class="field-input currency w-payoff" value="0.00"/>
            </div>
          </label>
        </div>

        <!-- Current mileage -->
        <div class="grid md:grid-cols-4 gap-4">
          <label class="block">
            <span class="field-label">Current mileage</span>
            <input id="miles" type="text" maxlength="8" class="field-input w-[16ch]" placeholder="Enter miles"/>
          </label>
        </div>

        <!-- Actions -->
        <div class="cta pt-2">
          <button type="button" id="backBtn" class="px-4 py-2 rounded-xl border bg-white/90 mr-3">← Back</button>
          <button type="submit" class="px-5 py-3 rounded-2xl bg-emerald-600 text-white font-semibold shadow hover:brightness-110">
            Pick a vehicle
          </button>
        </div>
      </form>
    </div>
  </div>

<script>
/* ---------------- helpers ---------------- */
const $ = (id) => document.getElementById(id);
const save = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

function formatMoney(val){
  const n = Number(val || 0);
  return n.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
}
function parseMoney(str){
  return Number(String(str || "0").replace(/[^\d.]/g,'') || 0);
}

/* ---------------- elements ---------------- */
const modelEl   = $('model');
const cabWrap   = $('cabWrap');
const cabEl     = $('cab');

const useEl     = $('use');
const towingEl  = $('towing');
const seatingEl = $('seating');
const fuelEl    = $('fuel');

const downEl    = $('downPayment');
const budgetEl  = $('budget');

const tradeYear = $('tradeYear');
const tradeMake = $('tradeMake');
const tradeModel= $('tradeModel');
const payoffEl  = $('payoff');
const milesEl   = $('miles');

const form      = $('discForm');
const backBtn   = $('backBtn');

/* ------------- data ------------- */
const RAW_MODELS = [
  'Blazer','Colorado','Corvette E-Ray','Corvette Stingray','Equinox',
  'Express Cargo 2500','Express Cargo 3500','Express Cutaway 3500',
  'Low Cab Forward 4500','Low Cab Forward 4500 HD','Low Cab Forward 5500 HD','Low Cab Forward 6500 HD',
  'Silverado 1500','Silverado 2500 HD','Silverado 3500 HD','Silverado 3500 HD Chassis Cab',
  'Silverado 4500 HD','Silverado 5500 HD','Silverado 6500 HD','Silverado EV',
  'Suburban','Tahoe','Trailblazer','Traverse','Trax'
];
function customSort(a,b){
  const weight = (name) => name.startsWith('Corvette') ? 0 : (name === 'Trax' ? 2 : 1);
  const wa = weight(a), wb = weight(b);
  if (wa !== wb) return wa - wb;
  return a.localeCompare(b);
}
const MODELS = [...RAW_MODELS].sort(customSort);

/* ------------- init lists ------------- */
function fillModels(){
  modelEl.innerHTML = MODELS.map(m => `<option>${m}</option>`).join('');
}
function isSilverado(model){ return /^Silverado\s(1500|2500|3500)/.test(model); }
function updateCabVisibility(){ cabWrap.classList.toggle('hidden', !isSilverado(modelEl.value || '')); }

function fillYears(){
  const thisYear = new Date().getFullYear();
  const start = 1990;
  const opts = [`<option value="" selected disabled>Select Year</option>`];
  for(let y=thisYear; y>=start; y--) opts.push(`<option>${y}</option>`);
  tradeYear.innerHTML = opts.join('');
}

/* ------------- “fresh” defaults ------------- */
function setFreshDefaults(){
  // DO NOT load from prior localStorage; start clean
  // Budget shown as 650.00 (formatted) and payoff as 0.00
  budgetEl.value = formatMoney(650);
  payoffEl.value = formatMoney(0);
  downEl.value   = "";               // placeholder visible
  milesEl.value  = "";               // placeholder visible
}

/* ------------- persistence ------------- */
function persist(){
  const data = {
    model: modelEl.value,
    cab: cabEl.value,
    use: useEl.value,
    towing: towingEl.value,
    seating: seatingEl.value,
    fuel: fuelEl.value,
    downPayment: parseMoney(downEl.value),
    budget: parseMoney(budgetEl.value),
    tradeYear: tradeYear.value || null,
    tradeMake: tradeMake.value || null,
    tradeModel: tradeModel.value || null,
    payoff: parseMoney(payoffEl.value),
    miles: milesEl.value ? Number(String(milesEl.value).replace(/[^\d]/g,'')) : null,
  };
  save('guided_needs', data);
  window.parent?.postMessage({ type: 'discovery:update', payload: { model: data.model } }, '*');
}

/* ------------- wire currency behavior ------------- */
function attachCurrency(el){
  el.addEventListener('blur', () => { el.value = formatMoney(parseMoney(el.value)); persist(); });
  el.addEventListener('input', () => { /* live store numeric */ persist(); });
}
[downEl, budgetEl, payoffEl].forEach(attachCurrency);

/* ------------- events ------------- */
[modelEl, cabEl, useEl, towingEl, seatingEl, fuelEl, tradeYear, tradeMake, tradeModel, milesEl]
  .forEach(el => el.addEventListener('input', persist));

modelEl.addEventListener('change', () => { updateCabVisibility(); persist(); });

backBtn.addEventListener('click', () => {
  window.parent?.postMessage({ type: 'discovery:back' }, '*');
});
form.addEventListener('submit', (e) => {
  e.preventDefault();
  persist();
  window.parent?.postMessage({ type: 'discovery:done' }, '*');
});

/* ------------- boot ------------- */
fillModels();
fillYears();
updateCabVisibility();
setFreshDefaults();
persist(); // store the initial fresh state
</script>
</body>
</html>
