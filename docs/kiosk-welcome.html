<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kiosk — Welcome</title>

  <base href="/Quirk-AI-Project-Overview/"/>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :focus-visible { outline: 2px solid #34d399; outline-offset: 2px; }
    body { background: transparent; }
  </style>
</head>
<body class="p-2">
  <div class="max-w-3xl mx-auto">
    <form id="welcomeForm" class="mt-2 grid gap-4">
      <div class="grid sm:grid-cols-2 gap-4">
        <label class="block">
          <span class="block text-center text-sm font-semibold text-slate-700 mb-1">Your name / company</span>
          <input id="name" type="text" class="w-full rounded-xl border p-3 bg-white"
                 placeholder="e.g., Quirk Auto" autocomplete="name">
        </label>

        <label class="block">
          <span class="block text-center text-sm font-semibold text-slate-700 mb-1">Let's keep in touch</span>
          <input
            id="contact"
            type="text"
            inputmode="text"
            class="w-full rounded-xl border p-3 bg-white"
            placeholder="10 digit phone or email address"
            autocomplete="email"
            aria-describedby="contactHelp">
        </label>
      </div>

      <div class="flex justify-end">
        <button type="submit" class="px-5 py-3 rounded-2xl bg-emerald-600 text-white font-semibold shadow hover:brightness-110">
          Continue →
        </button>
      </div>
    </form>
  </div>

<script>
/* ---------- tiny storage helpers ---------- */
const save = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };
const load = (k, def) => { try { const v = JSON.parse(localStorage.getItem(k)); return (v ?? def); } catch { return def; } };

const $ = (id) => document.getElementById(id);
const nameEl    = $('name');
const contactEl = $('contact');
const form      = $('welcomeForm');

/* ---------- email / phone helpers ---------- */
const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
const onlyDigits = (value) => (value || '').replace(/\D+/g, '');

function formatPhoneDigits(d) {
  const s = (d || '').slice(0, 10);
  const len = s.length;
  if (!len) return '';
  if (len < 4) return `(${s}`;
  if (len < 7) return `(${s.slice(0,3)}) ${s.slice(3)}`;
  return `(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6)}`;
}
function isLikelyEmail(val) { return /@|[a-z]/i.test(val); }

/* --------- DO NOT PREFILL from storage: defaults are blank --------- */
/* Optional seed from parent */
window.addEventListener('message', (e) => {
  const msg = e?.data || {};
  if (msg.type === 'welcome:init') {
    const p = msg.payload || {};
    if (typeof p.name === 'string') nameEl.value = p.name;
    if (typeof p.contact === 'string') {
      const d = onlyDigits(p.contact);
      contactEl.value = d ? formatPhoneDigits(d) : p.contact;
    }
  }
});

/* Live: mask phones; leave emails alone */
contactEl.addEventListener('input', (e) => {
  const val = e.target.value;
  if (isLikelyEmail(val)) return;
  const caretFromEnd = val.length - e.target.selectionStart;
  const formatted = formatPhoneDigits(onlyDigits(val));
  e.target.value = formatted;
  const newPos = Math.max(0, formatted.length - caretFromEnd);
  requestAnimationFrame(() => e.target.setSelectionRange(newPos, newPos));
});
contactEl.addEventListener('paste', (e) => {
  e.preventDefault();
  const text = (e.clipboardData || window.clipboardData).getData('text') || '';
  contactEl.value = isLikelyEmail(text) ? text.trim() : formatPhoneDigits(onlyDigits(text));
});

/* Save and advance */
form.addEventListener('submit', (e) => {
  e.preventDefault();
  const nameRaw = (nameEl.value || '').trim();
  const contactRaw = (contactEl.value || '').trim();

  const asEmail = emailRe.test(contactRaw);
  const digits = onlyDigits(contactRaw);
  const asPhone = digits.length === 10;

  if (!nameRaw) {
    alert('Please enter your name or company.');
    nameEl.focus();
    return;
  }
  if (!asEmail && !asPhone) {
    alert('Enter a valid email address or a 10-digit phone number.');
    contactEl.focus();
    return;
  }

  const contactFormatted = asPhone ? formatPhoneDigits(digits) : contactRaw;

  // Persist for downstream steps (we no longer prefill on load)
  const current = load('guided_profile', { name:'', contact:'', budget:400 });
  save('guided_profile', { ...current, name: nameRaw, contact: contactFormatted });

  // Tell parent to advance
  window.parent?.postMessage({ type:'welcome:done', payload:{ name: nameRaw, contact: contactFormatted } }, '*');
});
</script>
</body>
</html>
